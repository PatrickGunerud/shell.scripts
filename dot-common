#!/usr/bin/env bash
# ~/bin/dot-common
set -euo pipefail

# ---- USER CONFIG (override via env vars if you want) ----
DOT_REPO="${DOT_REPO:-/Users/patrickgunerud/repos/github/PatrickGunerud/patrick.my.dotfiles}"
DOT_MANIFEST="${DOT_MANIFEST:-$HOME/.dotfiles-manifest}"
DOT_STORE_DIR="${DOT_STORE_DIR:-$DOT_REPO/managed}"   # where files are copied inside repo
DOT_BACKUP_DIR="${DOT_BACKUP_DIR:-$HOME/.dotfiles-backups}"
# --------------------------------------------------------

log()  { printf '%s\n' "$*"; }
warn() { printf 'WARN: %s\n' "$*" >&2; }
die()  { printf 'ERROR: %s\n' "$*" >&2; exit 1; }

need_dir() { [[ -d "$1" ]] || die "Missing dir: $1"; }

ensure_manifest() {
  if [[ ! -f "$DOT_MANIFEST" ]]; then
    cat >&2 <<EOF
ERROR: Dotfiles manifest not found: $DOT_MANIFEST

Why this matters:
  These tools read a manifest file to know which files to back up/restore.

How to fix:
  cat > "$DOT_MANIFEST" <<'EOM'
  ~/.gitconfig
  ~/.ssh/*.pub
  ~/.vscode/extensions.json
  ~/.vscode/settings.json
  ~/.zshrc
  EOM

Then run:
  dot-backup --commit
